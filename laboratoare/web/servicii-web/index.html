<!DOCTYPE html> <!--[if IE 8]> <html lang="ro" class="ie8"> <![endif]--> <!--[if IE 9]> <html lang="ro" class="ie9"> <![endif]--> <!--[if !IE]><!--> <html lang="ro"> <!--<![endif]--> <head> <title>Implementarea şi invocarea serviciilor Web</title> <!-- Meta --> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" lang="ro" xml:lang="ro" content="Situl dedicat disciplinei Tehnologii Web" /> <meta name="keywords" lang="en" xml:lang="en" content="Web, WWW, technology, course, Romania, Iasi, Computer Science, university, academic, information, education, school, project, lang programming, document, software, application, student, grade" /> <meta name="keywords" lang="ro" xml:lang="ro" content="Web, WWW, technologie, curs, Romania, Iasi, Informatica, universitate, academic, informatie, educatie, scoala, proiect, limbaj, programare, document, software, aplicatie, student, nota" /> <link rel="shortcut icon" href="/~alex.coman/assets/images/favicon.ico"> <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'> <!-- Global CSS --> <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> <!-- Plugins CSS --> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.css"> <!-- Theme CSS --> <link id="theme-style" rel="stylesheet" href="/~alex.coman/assets/css/main.css"> <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries --> <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script> <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script> <![endif]--> <link rel="canonical" href="https://profs.info.uaic.ro/~alex.coman/laboratoare/web/servicii-web/"> <link rel="alternate" type="application/rss+xml" title="" href="/~alex.coman/feed.xml"> <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" integrity="sha256-3YM6A3pH4QFCl9WbSU8oXF5N6W/2ylvW0o2g+Z6TmLQ=" crossorigin="anonymous" /> </head> <body class="body-blue"> <div class="page-wrapper"> <header id="header" class="header "> <div class="container"> <div class="branding"> <h1 class="logo"> <a href="/laboratoare/web/servicii-web/"> <span aria-hidden="true" class="icon fas fa-university"></span> <span class="text-highlight">Tehnologii</span> <span class="text">Web</span> </a> </h1> </div> <ol class="breadcrumb"> <li><a href="//~alex.coman">Acasă</a></li> <li><a href="/~alex.coman/laboratoare">Laboratoare</a></li> <li><a href="/~alex.coman/laboratoare/web">Web</a></li> <li class="active">Implementarea şi invocarea serviciilor Web</li> </ol> </div> </header> <section id="blog_post" class="blog-post-section doc-wrapper"> <div class="container"> <div id="doc-header" class="doc-header text-center"> <h1 class="doc-title" itemprop="name headline"> <i class="icon fas fa-bug"></i> Implementarea şi invocarea serviciilor Web </h1> <div class="meta"> Publicat de: <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">Alexandru Coman</span> </span> pe <i class="fas fa-clock"></i> <time datetime="2019-05-15T12:00:00+00:00" itemprop="datePublished"> 15 mai 2019 </time> </div> </div> <div class="doc-body"> <div class="doc-content"> <div class="content-inner"> <section id="dashboards" class="doc-section"> <div class="section-block"> <h2 id="consultarea-resurselor">Consultarea resurselor</h2> <p>Acest laborator are la bază rezursele discutate la curs. Suplimentar puteți parcurge informațiile prezentate în următoarele articole <a href="/~alex.coman/resurse/tutorial/docker/docker-introducere/">Noțiuni introductive referitoare la Docker</a>, <a href="/~alex.coman/resurse/tutorial/docker/docker-imagini/">imagini</a> și <a href="/~alex.coman/resurse/tutorial/docker/docker-containere/">containere</a>.</p> <h2 id="recapitulare">Recapitulare</h2> <h3 id="exercițiu-de-laborator">Exercițiu de laborator</h3> <p>Implementați o aplicație web care să ofere utilizatorului o matrice pătratică (de o diminensiune configurabilă) populată cu puteri a lui 2 în ordine aleatorie. Aplicația trebuie să verifice dacă utilizatorul alege numerele în ordine crescătoare, iar în caz contrar îi va afișa un mesaj corespunzător.</p> <h3 id="soluție-incompletă">Soluție incompletă</h3> <p>În continuare aveți la dispoziție un exemplu asemănător pe care îl puteți modifica, rescrie sau extinde după caz pentru a ajunge la rezultatul dorit.</p> <p><img src="/~alex.coman/assets/images/laborator/web/servicii-web/matrix-exemplu-1.png" alt="Exemplu de implementare" /> <img src="/~alex.coman/assets/images/laborator/web/servicii-web/matrix-exemplu-2.png" alt="Exemplu de implementare" /></p> <p><strong>Important</strong>: Soluția prezentată mai jos reprezintă punctul de plecare pentru exercițiul curent. În implementarea curentă au fost intenționat introduse diverse probleme.</p> <p>Structura de fișiere și directoare pentru soluția curentă este următoarea:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>matrix
├── controller
│   └── MatrixController.php
├── index.php
├── model
│   └── MatrixModel.php
└── view
    └── MatrixView.php
</code></pre></div></div> <p>Fișierul: <code class="highlighter-rouge">matrix/controller/MatrixController.php</code>:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">require</span> <span class="nx">ROOT</span> <span class="o">.</span> <span class="s1">'model/MatrixModel.php'</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">MatrixController</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$rows</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$collumns</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MatrixModel</span><span class="p">(</span><span class="nv">$rows</span><span class="p">,</span> <span class="nv">$collumns</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">handle_get</span><span class="p">(){</span>
        <span class="nv">$matrix</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">model</span><span class="p">;</span>
        <span class="k">require</span> <span class="nx">ROOT</span> <span class="o">.</span> <span class="s1">'view/MatrixView.php'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">handle_post</span><span class="p">(){</span>
        <span class="nv">$matrix</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">model</span><span class="p">;</span>
        <span class="nv">$maxim</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nv">$current_item</span> <span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'item'</span><span class="p">]);</span>
        <span class="k">foreach</span> <span class="p">(</span><span class="nv">$matrix</span><span class="o">-&gt;</span><span class="na">get_items</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$matrix</span><span class="o">-&gt;</span><span class="na">get_state</span><span class="p">(</span><span class="nv">$item</span><span class="p">)){</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$item</span> <span class="o">&gt;</span> <span class="nv">$maxim</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nv">$maxim</span> <span class="o">=</span> <span class="nv">$item</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="nv">$maxim</span> <span class="o">==</span> <span class="nv">$matrix</span><span class="o">-&gt;</span><span class="na">get_count</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$matrix</span><span class="o">-&gt;</span><span class="na">clear</span><span class="p">();</span>
            <span class="nv">$message</span> <span class="o">=</span> <span class="s1">'Ai castigat!'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">elseif</span><span class="p">(</span><span class="nv">$current_item</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">==</span> <span class="nv">$maxim</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$message</span> <span class="o">=</span> <span class="s1">'Ai ales corect!'</span><span class="p">;</span>
            <span class="nv">$matrix</span><span class="o">-&gt;</span><span class="na">set_state</span><span class="p">(</span><span class="nv">$current_item</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$matrix</span><span class="o">-&gt;</span><span class="na">clear</span><span class="p">();</span>
            <span class="nv">$message</span> <span class="o">=</span> <span class="s1">'Ai raspuns gresit!'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">require</span> <span class="nx">ROOT</span> <span class="o">.</span> <span class="s1">'view/MatrixView.php'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">dispatch</span><span class="p">(){</span>
        <span class="nv">$request_method</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">"REQUEST_METHOD"</span><span class="p">]);</span>
        <span class="nv">$method_name</span> <span class="o">=</span> <span class="s2">"handle_</span><span class="nv">$request_method</span><span class="s2">"</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">method_exists</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="nv">$method_name</span><span class="p">)){</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$method_name</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
<span class="cp">?&gt;</span>
</code></pre></div></div> <p>Fișierul: <code class="highlighter-rouge">matrix/model/MatrixModel.php</code>:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">MatrixModel</span> <span class="p">{</span>

    <span class="k">private</span> <span class="nv">$rows</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$collumn</span><span class="p">;</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$rows</span><span class="p">,</span> <span class="nx">int</span> <span class="nv">$collumns</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">session_start</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">rows</span> <span class="o">=</span> <span class="nv">$rows</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">collumns</span> <span class="o">=</span> <span class="nv">$collumns</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">get_count</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">rows</span> <span class="o">*</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">collumns</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">get_rows</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">rows</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">get_collumns</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">collumns</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">get_items</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'items'</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'items'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_count</span><span class="p">());</span>
            <span class="nb">shuffle</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'items'</span><span class="p">]);</span>
            <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'status'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">array_fill</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_count</span><span class="p">(),</span> <span class="k">FALSE</span><span class="p">);</span>            
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'items'</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">get_state</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$item</span><span class="p">,</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'status'</span><span class="p">]))</span>
            <span class="k">return</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'status'</span><span class="p">][</span><span class="nv">$item</span><span class="p">];</span>
        <span class="k">return</span> <span class="k">NULL</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">set_state</span><span class="p">(</span><span class="nx">int</span> <span class="nv">$item</span><span class="p">,</span> <span class="nx">bool</span> <span class="nv">$value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">array_key_exists</span><span class="p">(</span><span class="nv">$item</span><span class="p">,</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'status'</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'status'</span><span class="p">][</span><span class="nv">$item</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$value</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">clear</span><span class="p">()</span> <span class="p">{</span>
        <span class="nb">unset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'items'</span><span class="p">]);</span>
        <span class="nb">unset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'status'</span><span class="p">]);</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div> <p>Fișierul: <code class="highlighter-rouge">matrix/view/MatrixView.php</code>:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>Matrix View<span class="nt">&lt;/title&gt;</span>
        <span class="nt">&lt;style&gt;</span>
            <span class="nc">.matrix</span> <span class="p">{</span>
              <span class="nl">margin</span><span class="p">:</span> <span class="m">0</span> <span class="nb">auto</span><span class="p">;</span>
              <span class="nl">display</span><span class="p">:</span> <span class="n">grid</span><span class="p">;</span>
              <span class="py">grid-gap</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
              <span class="py">grid-template-columns</span><span class="p">:</span> <span class="nb">repeat</span><span class="p">(</span><span class="cp">&lt;?=</span> <span class="nv">$matrix</span><span class="o">-&gt;</span><span class="na">get_collumns</span><span class="p">()</span> <span class="cp">?&gt;</span><span class="p">,</span> <span class="m">80px</span><span class="p">);</span>
              <span class="py">grid-template-rows</span><span class="p">:</span> <span class="nb">repeat</span><span class="p">(</span><span class="cp">&lt;?=</span> <span class="nv">$matrix</span><span class="o">-&gt;</span><span class="na">get_rows</span><span class="p">()</span> <span class="cp">?&gt;</span><span class="p">,</span> <span class="m">80px</span><span class="p">);</span>
              <span class="py">grid-auto-flow</span><span class="p">:</span> <span class="n">row</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nc">.cell</span> <span class="p">{</span>
              <span class="nl">padding</span><span class="p">:</span> <span class="m">16px</span><span class="p">;</span>
              <span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nt">input</span><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="nt">submit</span><span class="o">]</span> <span class="p">{</span>
              <span class="nl">height</span><span class="p">:</span> <span class="m">64px</span><span class="p">;</span>
              <span class="nl">width</span><span class="p">:</span> <span class="m">64px</span><span class="p">;</span>
              <span class="nl">background-color</span><span class="p">:</span> <span class="m">#fff</span><span class="p">;</span>
              <span class="nl">border-radius</span><span class="p">:</span> <span class="m">3px</span><span class="p">;</span>
              <span class="nl">border</span><span class="p">:</span> <span class="m">1px</span> <span class="nb">solid</span> <span class="no">black</span><span class="p">;</span>
              <span class="nl">font-size</span><span class="p">:</span> <span class="m">32px</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="nt">&lt;/style&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"#"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"matrix"</span><span class="nt">&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">foreach</span><span class="p">(</span><span class="nv">$matrix</span><span class="o">-&gt;</span><span class="na">get_items</span><span class="p">()</span> <span class="k">as</span> <span class="nv">$item</span><span class="p">)</span> <span class="p">{</span>
                <span class="nv">$disabled</span><span class="o">=</span><span class="s1">''</span><span class="p">;</span>
                <span class="k">if</span><span class="p">(</span><span class="nv">$matrix</span><span class="o">-&gt;</span><span class="na">get_state</span><span class="p">(</span><span class="nv">$item</span><span class="p">)){</span>
                    <span class="nv">$disabled</span><span class="o">=</span><span class="s1">'disabled'</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="cp">?&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"cell"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="cp">&lt;?=</span> <span class="nv">$disabled</span> <span class="cp">?&gt;</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"item"</span> <span class="na">value=</span><span class="s">"</span><span class="cp">&lt;?=</span> <span class="nv">$item</span> <span class="cp">?&gt;</span><span class="s">"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="cp">&lt;?php</span> <span class="p">}</span> <span class="cp">?&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$message</span><span class="p">))</span> <span class="p">{</span> <span class="cp">?&gt;</span>
                <span class="nt">&lt;div&gt;&lt;p&gt;</span><span class="cp">&lt;?=</span> <span class="nv">$message</span> <span class="cp">?&gt;</span><span class="nt">&lt;/p&gt;&lt;/div&gt;</span>
            <span class="cp">&lt;?php</span> <span class="p">}</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;/form&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div> <p>Fișierul: <code class="highlighter-rouge">matrix/index.php</code>:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">'ROOT'</span><span class="p">,</span> <span class="nx">__DIR__</span> <span class="o">.</span> <span class="nx">DIRECTORY_SEPARATOR</span><span class="p">);</span>

    <span class="k">require</span> <span class="nx">ROOT</span> <span class="o">.</span> <span class="s1">'controller/MatrixController.php'</span><span class="p">;</span>
    <span class="nv">$controller</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MatrixController</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
    <span class="nv">$controller</span><span class="o">-&gt;</span><span class="na">dispatch</span><span class="p">();</span>
<span class="cp">?&gt;</span>
</code></pre></div></div> <h2 id="test-de-laborator---1">Test de laborator - 1</h2> <h3 id="enunț">Enunț</h3> <p>Scrieți o aplicație web care să-i permită utilizatorului să ghicească suma obținută prin aruncarea a două zaruri. Utilizatorul va avea posibilitatea să ghicească suma obținută prin aruncarea celor două zaruri de maxim 5 ori. Pentru fiecare dintre cele 5 încercări utilizatorul va primi un mesaj care să-l ajute să afle rezultatul corect.</p> <p>Cerințe:</p> <ul> <li>Informațiile despre valorile obținute în urma aruncării celor două zaruri vor fi stocate la nivel de server folosind sesiuni.</li> <li>În momentul în care utilizatorul ghicește sau consumă cele trei încercări pe lângă mesajul corespunzător va primi informații și despre valoarea celor două zaruri și i se oferă posibilitatea să încerce din nou după o nouă “aruncare de zaruri”.</li> <li>Procesarea datelor se va face la nivel de server</li> </ul> <p>Exemplu de feedback din partea aplicației, dacă pentru această etapă de joc cele două zaruri au valorile (6, 2):</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Răspuns: 6
Suma propusă este mai mică.

Răspuns: 7
Suma propusă este mai mică.

Răspuns: 8
Felicitări ai răspuns corect!

Valorile obținute după aruncarea zarurilor sunt (6, 2).
</code></pre></div></div> <p>sau</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Răspuns: 1
Suma propusă este mai mare.

Răspuns: 2
Suma propusă este mai mică.

Răspuns: 3
Suma propusă este mai mică.

Răspuns: 3
Suma propusă este mai mică.

Răspuns: 5
Răspuns greșit. Din păcate nu ai ghicit.

Valorile obținute după aruncarea zarurilor sunt (6, 2).
</code></pre></div></div> <h3 id="soluție-posibilă">Soluție posibilă</h3> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
    <span class="c1">// Definim numărul de încercări disponibile pentru utilizator.</span>
    <span class="nb">define</span><span class="p">(</span><span class="nx">RETRY_COUNT</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

    <span class="c1">// Pentru stocarea informațiilor o să folosim sesiuni.</span>
    <span class="nb">session_start</span><span class="p">();</span>

    <span class="c1">// Verificăm dacă utilizatorul dorește să înceapă un nou joc.</span>
    <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'reset'</span><span class="p">])){</span>
        <span class="c1">// O să ștergem toate informațiile din sesiunea curentă.</span>
        <span class="nb">unset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'suma'</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="c1">// Definim o serie de variabile care o să definească starea</span>
    <span class="c1">// în care se află acum aplicația.</span>
    <span class="nv">$flag_game_over</span> <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span> <span class="c1">// Jocul este în derulare.</span>
    <span class="nv">$flag_winner</span>    <span class="o">=</span> <span class="k">FALSE</span><span class="p">;</span> <span class="c1">// Implicit utilizatorul a pierdut jocul.</span>


    <span class="c1">// Verificam daca au fost obținute informațiile referitoare la</span>
    <span class="c1">// cele două zaruri.</span>
    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'suma'</span><span class="p">]))</span> <span class="p">{</span>
        <span class="c1">// Inițializăm valoarea pentru primul zar.</span>
        <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'zar1'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">random_int</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
        <span class="c1">// Inițializăm valoarea pentru al doilea zar.</span>
        <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'zar2'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">random_int</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
        <span class="c1">// Calculăm suma pe care trebuie să o ghicească utilizatorul.</span>
        <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'suma'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'zar1'</span><span class="p">]</span> <span class="o">+</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'zar2'</span><span class="p">];</span>
        <span class="c1">// Inițializăm contorul care o să rețină numărul de încercări</span>
        <span class="c1">// pentru utilizatorul curent.</span>
        <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="nv">$message</span> <span class="o">=</span> <span class="s1">'S-au aruncat două zaruri, ghicește suma acestora.'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Verificăm dacă utilizatorul mai are la dispoziție încercări</span>
    <span class="c1">// de a răspunde.</span>
    <span class="k">if</span><span class="p">(</span><span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nx">RETRY_COUNT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Utilizatorul a epuizat toate încercările pe care le avea</span>
        <span class="c1">// la dispoziție.</span>
        <span class="nv">$flag_game_over</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span>
        <span class="nv">$message</span> <span class="o">=</span> <span class="s1">'Din păcate nu ai ghicit suma.'</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// Verificăm informațiile pe are le-am primit de la utilizator.</span>
    <span class="k">elseif</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'raspuns'</span><span class="p">])){</span>
        <span class="c1">// Incrementăm contorul ce reține numărul de încercări</span>
        <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="c1">// Obținem valoare pe care a propus-o utilizatorul.</span>
        <span class="nv">$suma</span> <span class="o">=</span> <span class="nb">intval</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s1">'raspuns'</span><span class="p">]);</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$suma</span> <span class="o">==</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'suma'</span><span class="p">]){</span>
            <span class="nv">$message</span> <span class="o">=</span> <span class="s1">'Felicitări ai ghicit suma.'</span><span class="p">;</span>
            <span class="c1">// Notificăm faptul că jocul s-a terminat.</span>
            <span class="nv">$flag_game_over</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span>
            <span class="c1">// Notificăm faptul că utilizatorul a câștigat jocul.</span>
            <span class="nv">$flag_winner</span> <span class="o">=</span> <span class="k">TRUE</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">elseif</span><span class="p">(</span><span class="nv">$suma</span> <span class="o">&lt;</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'suma'</span><span class="p">]){</span>
            <span class="nv">$message</span> <span class="o">=</span> <span class="s1">'Suma propusa este mai mica.'</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$message</span> <span class="o">=</span> <span class="s1">'Suma propusa este mai mare.'</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="cp">?&gt;</span>

<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;title&gt;</span>Tehnologii web - Test 1<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;div&gt;&lt;p&gt;</span><span class="cp">&lt;?=</span> <span class="nv">$message</span> <span class="cp">?&gt;</span><span class="nt">&lt;/p&gt;&lt;/div&gt;</span>
        <span class="cp">&lt;?php</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$flag_game_over</span><span class="p">)</span> <span class="p">{</span> 
                <span class="c1">// Jocul s-a terminat. O să afișăm mesajul corespunzător</span>
                <span class="c1">// stării jocului urmate de valorile pentru cele două</span>
                <span class="c1">// zaruri.</span>
        <span class="cp">?&gt;</span>
            <span class="nt">&lt;div&gt;</span>
                <span class="nt">&lt;p&gt;</span>Valorile pentru cele două zaruri au fost:<span class="nt">&lt;/p&gt;</span>
                <span class="nt">&lt;ul&gt;</span>
                    <span class="nt">&lt;li&gt;</span>Zarul 1: <span class="cp">&lt;?=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'zar1'</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li&gt;</span>Zarul 2: <span class="cp">&lt;?=</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'zar2'</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="nt">&lt;/li&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
                <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">""</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"reset"</span> <span class="na">value=</span><span class="s">"Incepe un nou joc!"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="cp">&lt;?php</span> 
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> 
                <span class="c1">// Jocul este în derulare. O să afișăm utilizatorului formularul</span>
                <span class="c1">// prin intermediul căruia poate să trimită răspunsul către </span>
                <span class="c1">// server și o serie de informații care să-l ghideze pe parcursul</span>
                <span class="c1">// jocului.</span>
        <span class="cp">?&gt;</span>
            <span class="nt">&lt;form</span> <span class="na">action=</span><span class="s">"#"</span> <span class="na">method=</span><span class="s">"POST"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"text"</span> <span class="na">name=</span><span class="s">"raspuns"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"submit"</span> <span class="na">name=</span><span class="s">"submit"</span> <span class="na">value=</span><span class="s">"Raspunde"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;div&gt;</span>
                <span class="nt">&lt;p&gt;</span>
                    Numărul de încercări rămase este:
                    <span class="cp">&lt;?=</span> <span class="nx">RETRY_COUNT</span> <span class="o">-</span> <span class="nv">$_SESSION</span><span class="p">[</span><span class="s1">'count'</span><span class="p">]</span> <span class="cp">?&gt;</span>    
                <span class="nt">&lt;/p&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="cp">&lt;?php</span> <span class="p">}</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div> <h2 id="invocarea-serviciilor-web">Invocarea serviciilor web</h2> <h3 id="exercițiu-de-laborator-1">Exercițiu de laborator</h3> <p>Scrieți o aplicație web care să proceseze conținutul în format JSON oferit de <code class="highlighter-rouge">https://jsonplaceholder.typicode.com/todos/</code>.</p> <p>Aplicația va trebuie să afișeze în format JSON următoarele informații:</p> <ul> <li>Numărul total de utilizatori</li> <li>ID-ul utilizatorului cu cele mai multe TODOs</li> </ul> <h3 id="punct-de-plecare">Punct de plecare</h3> <p>Fișierul <code class="highlighter-rouge">index.php</code>:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
    <span class="k">require</span> <span class="s1">'request.php'</span><span class="p">;</span>
    <span class="nv">$request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HTTPRequest</span><span class="p">();</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">'https://jsonplaceholder.typicode.com/todos/'</span><span class="p">);</span>

    <span class="nv">$message</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
        <span class="s1">'meta'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'error'</span>  <span class="o">=&gt;</span> <span class="nv">$request</span><span class="o">-&gt;</span><span class="na">get_last_error</span><span class="p">(),</span>
            <span class="s1">'status'</span> <span class="o">=&gt;</span> <span class="k">array</span><span class="p">(</span>
                <span class="s1">'code'</span>    <span class="o">=&gt;</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">status_code</span><span class="p">,</span>
                <span class="s1">'message'</span> <span class="o">=&gt;</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">status_message</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="s1">'headers'</span> <span class="o">=&gt;</span> <span class="nv">$response</span><span class="o">-&gt;</span><span class="na">headers</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s1">'response'</span> <span class="o">=&gt;</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$response</span><span class="o">-&gt;</span><span class="na">body</span><span class="p">),</span>
    <span class="p">);</span>

    <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-type: text/javascript'</span><span class="p">);</span>
    <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$message</span><span class="p">,</span> <span class="nx">JSON_PRETTY_PRINT</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div> <p>Fișierul <code class="highlighter-rouge">request.php</code>:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">HTTPResponse</span> <span class="p">{</span>
    <span class="k">public</span> <span class="nv">$body</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$headers</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$status_code</span><span class="p">;</span>
    <span class="k">public</span> <span class="nv">$status_message</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$raw_response</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">__construct</span><span class="p">(</span><span class="nv">$response</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">raw_response</span> <span class="o">=</span> <span class="nv">$response</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">headers</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">status_code</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">status_message</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">body</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parse</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">parse_headers</span><span class="p">(</span><span class="nv">$raw_headers</span><span class="p">){</span>
        <span class="nv">$headers</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s2">"</span><span class="se">\r\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$raw_headers</span><span class="p">);</span>
        
        <span class="nv">$status</span> <span class="o">=</span> <span class="nb">array_shift</span><span class="p">(</span><span class="nv">$headers</span><span class="p">);</span>
        <span class="nb">preg_match</span><span class="p">(</span><span class="s1">'#HTTP/(\d\.\d)\s(\d\d\d)\s(.*)#'</span><span class="p">,</span> <span class="nv">$status</span><span class="p">,</span> <span class="nv">$matches</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">status_code</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">status_message</span> <span class="o">=</span> <span class="nv">$matches</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

        <span class="k">foreach</span><span class="p">(</span><span class="nv">$headers</span> <span class="k">as</span> <span class="nv">$raw_header</span><span class="p">){</span>
            <span class="nv">$header</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">':'</span><span class="p">,</span> <span class="nv">$raw_header</span><span class="p">);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">headers</span><span class="p">[</span><span class="nb">trim</span><span class="p">(</span><span class="nv">$header</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$header</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
        <span class="p">}</span>
        
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">parse</span><span class="p">(){</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s2">"</span><span class="se">\r\n\r\n</span><span class="s2">"</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">raw_response</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parse_headers</span><span class="p">(</span><span class="nv">$response</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">body</span> <span class="o">=</span> <span class="nv">$response</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
    <span class="p">}</span>
    
<span class="p">}</span>


<span class="k">class</span> <span class="nc">HTTPRequest</span> <span class="p">{</span>
    
    <span class="k">protected</span> <span class="nv">$user_agent</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$error</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$request</span><span class="p">;</span>
    <span class="k">protected</span> <span class="nv">$headers</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user_agent</span> <span class="o">=</span> <span class="s1">'Curl/Exerciții Tehnologii Web'</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_USER_AGENT'</span><span class="p">])){</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user_agent</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">'HTTP_USER_AGENT'</span><span class="p">];</span>    
        <span class="p">}</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">headers</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">error</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">set_method</span><span class="p">(</span><span class="nv">$method</span><span class="p">){</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nb">strtoupper</span><span class="p">(</span><span class="nv">$method</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s1">'GET'</span><span class="o">:</span>
                <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPGET</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s1">'POST'</span><span class="o">:</span>
                <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">,</span> <span class="nx">CURLOPT_POST</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">,</span> <span class="nx">CURLOPT_CUSTOMREQUEST</span><span class="p">,</span> <span class="nv">$method</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">set_options</span><span class="p">(){</span>
        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">,</span> <span class="nx">CURLOPT_HTTPHEADER</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">headers</span><span class="p">);</span>
        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">,</span> <span class="nx">CURLOPT_HEADER</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">,</span> <span class="nx">CURLOPT_USERAGENT</span><span class="p">,</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">user_agent</span><span class="p">);</span> 
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">request</span><span class="p">(</span><span class="nv">$method</span><span class="p">,</span> <span class="nv">$url</span><span class="p">,</span> <span class="nv">$vars</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">error</span> <span class="o">=</span> <span class="s1">''</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">set_method</span><span class="p">(</span><span class="nv">$method</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">set_options</span><span class="p">();</span>

        <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">is_array</span><span class="p">(</span><span class="nv">$vars</span><span class="p">)</span> <span class="k">and</span> <span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$vars</span><span class="p">)){</span>
            <span class="nv">$vars</span> <span class="o">=</span> <span class="nb">http_build_query</span><span class="p">(</span><span class="nv">$vars</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'&amp;'</span><span class="p">);</span>
            <span class="nb">curl_setopt</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">,</span> <span class="nx">CURLOPT_POSTFIELDS</span><span class="p">,</span> <span class="nv">$vars</span><span class="p">);</span>
        <span class="p">}</span>
       
        <span class="nv">$response</span> <span class="o">=</span> <span class="nb">curl_exec</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nv">$response</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$response</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HTTPResponse</span><span class="p">(</span><span class="nv">$response</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">error</span> <span class="o">=</span> <span class="nb">curl_error</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">);</span>
        <span class="p">}</span>
        
        <span class="nb">curl_close</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="nf">get_last_error</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">error</span><span class="p">;</span>
    <span class="p">}</span>    

    <span class="k">function</span> <span class="nf">get</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nv">$vars</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$vars</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$url</span> <span class="o">.=</span> <span class="p">(</span><span class="nb">stripos</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="s1">'?'</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="o">?</span> <span class="s1">'&amp;'</span> <span class="o">:</span> <span class="s1">'?'</span><span class="p">;</span>
            <span class="nv">$url</span> <span class="o">.=</span> <span class="p">(</span><span class="nb">is_string</span><span class="p">(</span><span class="nv">$vars</span><span class="p">))</span> <span class="o">?</span> <span class="nv">$vars</span> <span class="o">:</span> <span class="nb">http_build_query</span><span class="p">(</span><span class="nv">$vars</span><span class="p">,</span> <span class="s1">''</span><span class="p">,</span> <span class="s1">'&amp;'</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">'GET'</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">function</span> <span class="nf">post</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nv">$vars</span> <span class="o">=</span> <span class="k">array</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">request</span><span class="p">(</span><span class="s1">'POST'</span><span class="p">,</span> <span class="nv">$url</span><span class="p">,</span> <span class="nv">$vars</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
</code></pre></div></div> <h3 id="alternativă-simplificată">Alternativă simplificată</h3> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="nb">define</span> <span class="p">(</span><span class="s1">'URL'</span><span class="p">,</span> <span class="s1">'https://jsonplaceholder.typicode.com/todos/'</span><span class="p">);</span>
<span class="k">echo</span> <span class="s1">'&lt;p&gt;Invoking Web service from &lt;code&gt;'</span> <span class="o">.</span> <span class="nx">URL</span> <span class="o">.</span> <span class="s1">'&lt;/code&gt;&lt;/p&gt;'</span><span class="p">;</span>

<span class="nv">$request</span> <span class="o">=</span> <span class="nb">curl_init</span><span class="p">();</span>
<span class="c1">// Stabilim URL-ul serviciului</span>
<span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">CURLOPT_URL</span><span class="p">,</span> <span class="nx">URL</span><span class="p">);</span>
<span class="c1">// Rezultatul cererii va fi disponibil ca șir de caractere</span>
<span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">CURLOPT_RETURNTRANSFER</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
 <span class="c1">// Nu verificam certificatul digital</span>
<span class="nb">curl_setopt</span> <span class="p">(</span><span class="nv">$request</span><span class="p">,</span> <span class="nx">CURLOPT_SSL_VERIFYPEER</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
<span class="c1">// Executam cererea GET</span>
<span class="nv">$response</span> <span class="o">=</span> <span class="nb">curl_exec</span> <span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
<span class="c1">// Închidem conexiunea</span>
<span class="nb">curl_close</span> <span class="p">(</span><span class="nv">$request</span><span class="p">);</span>
<span class="c1">// Deserealizăm datele</span>
<span class="nv">$data</span> <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$response</span><span class="p">);</span>
<span class="c1">// Afișăm conținutul variabilei $data.</span>
<span class="nb">print_r</span><span class="p">(</span><span class="nv">$data</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div> <h2 id="test-de-laborator---2">Test de laborator - 2</h2> <p>Implementați o aplicație web care să consume informațiile despre filmele Star Wars disponibile la adresa <code class="highlighter-rouge">https://swapi.co/api/</code>.</p> <ul> <li> <p>Aplicația trebuie să ofere utilizatorului doar informațiile despre planetele (<code class="highlighter-rouge">/api/planets</code>) ce apar în cel puțin 3 filme (<code class="highlighter-rouge">/api/films</code>) Star War.</p> </li> <li> <p>Aplicația trebuie să ofere utilizatorului doar informațiile despre piloții (<code class="highlighter-rouge">/api/people</code>) care au folosit cel puțin două nave (<code class="highlighter-rouge">/api/starships</code>) diferite.</p> </li> <li> <p>Aplicația trebuie să ofere utilizatorului doar informațiile despre planeta natală (<code class="highlighter-rouge">/api/plantes</code>) a speciilor (<code class="highlighter-rouge">/api/species</code>) care au culoare pielii <code class="highlighter-rouge">magenta</code>.</p> </li> <li> <p>Aplicația trebuie să ofere utilizatorului doar informațiile despre speciile (<code class="highlighter-rouge">/api/species</code>) care apar în cel puțin 3 filme (<code class="highlighter-rouge">/api/films</code>).</p> </li> <li> <p>Aplicația trebuie să ofere utilizatorului numele vehiculelor cu un număr de membrii ai echipajului mai mare de 15 și numele filmelor în care au apărut.</p> </li> </ul> <p><strong>Notă</strong>: Aplicația trebuie să facă cel puțin două cereri HTTP.</p> <h2 id="implementarea-serviciilor-web">Implementarea serviciilor web</h2> <h3 id="exercițiu-de-laborator-2">Exercițiu de laborator</h3> <p><strong>Important</strong>: Fragmentele de cod prezentate mai jos reprezintă punctul de plecare pentru exercițiul curent. În implementarea curentă au fost intenționat introduse diverse probleme.</p> <p>Pe baza discuțiilor din cadrul laboratorului va trebui să corectăm toate problemele existente.</p> <p>Structura de fișiere și directoare pentru soluția curentă este următoarea:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>├── application
│   ├── Config
│   │   └── config.php
│   ├── Controller
│   │   └── SongsController.php
│   └── Model
│       └── SongsModel.php
├── core
│   ├── Application.php
│   ├── Controller.php
│   └── Model.php
└── index.php
</code></pre></div></div> <p>Fișierul <code class="highlighter-rouge">application/Config/config.php</code>:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">'DB_HOST'</span><span class="p">,</span> <span class="s1">'&lt;Change me: host     &gt;'</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">'DB_NAME'</span><span class="p">,</span> <span class="s1">'&lt;Change me: database &gt;'</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">'DB_USER'</span><span class="p">,</span> <span class="s1">'&lt;Change me: user     &gt;'</span><span class="p">);</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">'DB_PASS'</span><span class="p">,</span> <span class="s1">'&lt;Change me: parola   &gt;'</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div> <p>Fișierul <code class="highlighter-rouge">application/Controller/SongsController.php</code></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">require</span> <span class="nx">ROOT</span> <span class="o">.</span> <span class="s1">'core/Controller.php'</span><span class="p">;</span>
<span class="k">require</span> <span class="nx">ROOT</span> <span class="o">.</span> <span class="s1">'application/Model/SongsModel.php'</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SongsController</span> <span class="k">extends</span> <span class="nx">Controller</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle_get</span><span class="p">(</span><span class="nv">$song_id</span><span class="o">=</span><span class="k">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$song_model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SongModel</span><span class="p">();</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$song_id</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$song</span> <span class="o">=</span> <span class="nv">$song_model</span><span class="o">-&gt;</span><span class="na">get_song</span><span class="p">(</span><span class="nv">$song_id</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$song</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nv">$song</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nv">$songs</span> <span class="o">=</span> <span class="nv">$song_model</span><span class="o">-&gt;</span><span class="na">get_songs</span><span class="p">();</span>
            <span class="nv">$count</span> <span class="o">=</span> <span class="nv">$song_model</span><span class="o">-&gt;</span><span class="na">get_count</span><span class="p">();</span>
            <span class="nv">$response</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s2">"count"</span> <span class="o">=&gt;</span> <span class="nv">$count</span><span class="p">,</span> <span class="s2">"results"</span> <span class="o">=&gt;</span> <span class="nv">$songs</span><span class="p">);</span>
            <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>            
        <span class="p">}</span>
        <span class="nb">http_response_code</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle_post</span><span class="p">()</span> <span class="p">{</span>
        <span class="c1">// FIXME: Verificarea parametrilor !!!</span>
        <span class="nv">$song_model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SongModel</span><span class="p">();</span>
        <span class="nv">$index</span> <span class="o">=</span> <span class="nv">$song_model</span><span class="o">-&gt;</span><span class="na">add_song</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"artist"</span><span class="p">],</span>
                                       <span class="nv">$_POST</span><span class="p">[</span><span class="s2">"track"</span><span class="p">],</span> 
                                       <span class="nv">$_POST</span><span class="p">[</span><span class="s2">"link"</span><span class="p">]);</span>
        <span class="nv">$response</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
            <span class="s1">'id'</span>     <span class="o">=&gt;</span> <span class="nv">$index</span><span class="p">,</span>
            <span class="s1">'artist'</span> <span class="o">=&gt;</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"artist"</span><span class="p">]),</span>
            <span class="s1">'track'</span>  <span class="o">=&gt;</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"track"</span><span class="p">]),</span>
            <span class="s1">'link'</span>   <span class="o">=&gt;</span> <span class="nb">htmlentities</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"link"</span><span class="p">])</span>
        <span class="p">);</span>
        <span class="k">return</span> <span class="nv">$response</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle_delete</span><span class="p">(</span><span class="nv">$song_id</span><span class="o">=</span><span class="k">NULL</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">is_null</span><span class="p">(</span><span class="nv">$song_id</span><span class="p">))</span> <span class="p">{</span>
            <span class="nv">$song_model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SongModel</span><span class="p">();</span>
            <span class="nv">$song</span> <span class="o">=</span> <span class="nv">$song_model</span><span class="o">-&gt;</span><span class="na">get_song</span><span class="p">(</span><span class="nv">$song_id</span><span class="p">);</span>
            <span class="k">if</span><span class="p">(</span><span class="nv">$song</span><span class="p">){</span>
                <span class="nv">$song_model</span><span class="o">-&gt;</span><span class="na">delete_song</span><span class="p">(</span><span class="nv">$song_id</span><span class="p">);</span>
                <span class="k">return</span> <span class="nv">$song</span><span class="p">;</span>    
            <span class="p">}</span>
            
        <span class="p">}</span>
        <span class="nb">http_response_code</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">handle_put</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$song_model</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SongModel</span><span class="p">();</span>
        <span class="c1"># $song_model-&gt;update_song($_POST["artist"],</span>
        <span class="c1">#                           $_POST["track"], </span>
        <span class="c1">#                           $_POST["link"],</span>
        <span class="c1">#                           $_POST['song_id']);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Fișierul <code class="highlighter-rouge">application/Model/SongsModel.php</code></p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">require</span> <span class="nx">ROOT</span> <span class="o">.</span> <span class="s1">'core/Model.php'</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">SongModel</span> <span class="k">extends</span> <span class="nx">Model</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">get_songs</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT id, artist, track, link FROM song"</span><span class="p">;</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">connection</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
        <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">fetchAll</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">get_song</span><span class="p">(</span><span class="nv">$song_id</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT id, artist, track, link FROM song WHERE id = :song_id LIMIT 1"</span><span class="p">;</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">connection</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
        <span class="nv">$parameters</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">':song_id'</span> <span class="o">=&gt;</span> <span class="nv">$song_id</span><span class="p">);</span>
        <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$parameters</span><span class="p">);</span>
        <span class="k">return</span> <span class="p">(</span><span class="nv">$query</span><span class="o">-&gt;</span><span class="na">rowcount</span><span class="p">()</span> <span class="o">?</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">)</span> <span class="o">:</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">add_song</span><span class="p">(</span><span class="nv">$artist</span><span class="p">,</span> <span class="nv">$track</span><span class="p">,</span> <span class="nv">$link</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"INSERT INTO song (artist, track, link) VALUES (:artist, :track, :link)"</span><span class="p">;</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">connection</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
        <span class="nv">$parameters</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">':artist'</span> <span class="o">=&gt;</span> <span class="nv">$artist</span><span class="p">,</span> <span class="s1">':track'</span> <span class="o">=&gt;</span> <span class="nv">$track</span><span class="p">,</span> <span class="s1">':link'</span> <span class="o">=&gt;</span> <span class="nv">$link</span><span class="p">);</span>
        <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$parameters</span><span class="p">);</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">connection</span><span class="o">-&gt;</span><span class="na">lastInsertId</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">delete_song</span><span class="p">(</span><span class="nv">$song_id</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"DELETE FROM song WHERE id = :song_id"</span><span class="p">;</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">connection</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
        <span class="nv">$parameters</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">':song_id'</span> <span class="o">=&gt;</span> <span class="nv">$song_id</span><span class="p">);</span>
        <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$parameters</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">update_song</span><span class="p">(</span><span class="nv">$artist</span><span class="p">,</span> <span class="nv">$track</span><span class="p">,</span> <span class="nv">$link</span><span class="p">,</span> <span class="nv">$song_id</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"UPDATE song SET artist = :artist, track = :track, link = :link WHERE id = :song_id"</span><span class="p">;</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">connection</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
        <span class="nv">$parameters</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span><span class="s1">':artist'</span> <span class="o">=&gt;</span> <span class="nv">$artist</span><span class="p">,</span> <span class="s1">':track'</span> <span class="o">=&gt;</span> <span class="nv">$track</span><span class="p">,</span> <span class="s1">':link'</span> <span class="o">=&gt;</span> <span class="nv">$link</span><span class="p">,</span> <span class="s1">':song_id'</span> <span class="o">=&gt;</span> <span class="nv">$song_id</span><span class="p">);</span>
        <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">(</span><span class="nv">$parameters</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">get_count</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$sql</span> <span class="o">=</span> <span class="s2">"SELECT COUNT(id) AS count FROM song"</span><span class="p">;</span>
        <span class="nv">$query</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">connection</span><span class="o">-&gt;</span><span class="na">prepare</span><span class="p">(</span><span class="nv">$sql</span><span class="p">);</span>
        <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>
        <span class="k">return</span> <span class="nv">$query</span><span class="o">-&gt;</span><span class="na">fetch</span><span class="p">(</span><span class="nx">PDO</span><span class="o">::</span><span class="na">FETCH_ASSOC</span><span class="p">)[</span><span class="s1">'count'</span><span class="p">];</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span>
</code></pre></div></div> <p>Fișierul <code class="highlighter-rouge">core/Application.php</code>:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Application</span> <span class="p">{</span>
    
    <span class="k">private</span> <span class="nv">$controller</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$controller_name</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">private</span> <span class="nv">$params</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">parse_url</span><span class="p">();</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get_controller</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">get_controller</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">ctype_alpha</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller_name</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
        
        <span class="nv">$controller_name</span> <span class="o">=</span> <span class="nb">ucfirst</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller_name</span><span class="p">)</span> <span class="o">.</span> 
                           <span class="s1">'Controller'</span><span class="p">;</span>
        <span class="nv">$controller_path</span> <span class="o">=</span> <span class="nx">ROOT</span> <span class="o">.</span> <span class="s1">'application/Controller/'</span> <span class="o">.</span>
                           <span class="nv">$controller_name</span> <span class="o">.</span> <span class="s1">'.php'</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">file_exists</span><span class="p">(</span><span class="nv">$controller_path</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>

        <span class="k">require</span> <span class="nv">$controller_path</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span> <span class="o">=</span> <span class="k">new</span> <span class="nv">$controller_name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">parse_url</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'url'</span><span class="p">]))</span> <span class="p">{</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="nb">trim</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'url'</span><span class="p">],</span> <span class="s1">'/'</span><span class="p">);</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="nb">filter_var</span><span class="p">(</span><span class="nv">$url</span><span class="p">,</span> <span class="nx">FILTER_SANITIZE_URL</span><span class="p">);</span>
            <span class="nv">$url</span> <span class="o">=</span> <span class="nb">explode</span><span class="p">(</span><span class="s1">'/'</span><span class="p">,</span> <span class="nv">$url</span><span class="p">);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller_name</span> <span class="o">=</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$url</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$url</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
            <span class="nb">unset</span><span class="p">(</span><span class="nv">$url</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">params</span> <span class="o">=</span> <span class="nb">array_values</span><span class="p">(</span><span class="nv">$url</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">dispatch</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">controller</span><span class="o">-&gt;</span><span class="na">dispatch</span><span class="p">(</span><span class="nv">$this</span><span class="o">-&gt;</span><span class="na">params</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nb">http_response_code</span><span class="p">(</span><span class="mi">404</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span>
</code></pre></div></div> <p>Fișierul <code class="highlighter-rouge">core/Controller.php</code>:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Controller</span> <span class="p">{</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">dispatch</span><span class="p">(</span><span class="nv">$params</span><span class="o">=</span><span class="k">array</span><span class="p">()){</span>
        <span class="nv">$request_method</span> <span class="o">=</span> <span class="nb">strtolower</span><span class="p">(</span><span class="nv">$_SERVER</span><span class="p">[</span><span class="s2">"REQUEST_METHOD"</span><span class="p">]);</span>
        <span class="nv">$method_name</span> <span class="o">=</span> <span class="s2">"handle_</span><span class="nv">$request_method</span><span class="s2">"</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="nb">method_exists</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="nv">$method_name</span><span class="p">)){</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">empty</span><span class="p">(</span><span class="nv">$params</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nb">call_user_func_array</span><span class="p">(</span><span class="k">array</span><span class="p">(</span><span class="nv">$this</span><span class="p">,</span> <span class="nv">$method_name</span><span class="p">),</span>
                                            <span class="nv">$params</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="nv">$method_name</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nb">http_response_code</span><span class="p">(</span><span class="mi">405</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">?&gt;</span>
</code></pre></div></div> <p>Fișierul <code class="highlighter-rouge">core/Model.php</code>:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">Model</span> <span class="p">{</span>

    <span class="k">public</span> <span class="nv">$connection</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

    <span class="k">function</span> <span class="nf">__construct</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">connect</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\PDOException</span> <span class="nv">$exc</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">exit</span><span class="p">(</span><span class="s1">'Database connection could not be established.'</span> <span class="o">.</span> <span class="nv">$exc</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="k">function</span> <span class="nf">connect</span><span class="p">()</span> <span class="p">{</span>
        <span class="nv">$connection_string</span> <span class="o">=</span> <span class="s1">'mysql:host='</span> <span class="o">.</span> <span class="nx">DB_HOST</span> <span class="o">.</span> <span class="s1">';dbname='</span> <span class="o">.</span> <span class="nx">DB_NAME</span> <span class="o">.</span> <span class="s1">';'</span><span class="p">;</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">connection</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PDO</span><span class="p">(</span><span class="nv">$connection_string</span><span class="p">,</span> <span class="nx">DB_USER</span><span class="p">,</span> <span class="nx">DB_PASS</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <p>Fișierul <code class="highlighter-rouge">.htaccess</code>:</p> <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>RewriteEngine on

RewriteRule ^(.+)$ index.php?url=$1 [QSA,L]
</code></pre></div></div> <p>Fișierul <code class="highlighter-rouge">index.php</code>:</p> <div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?php</span>
    <span class="nb">define</span><span class="p">(</span><span class="s1">'ROOT'</span><span class="p">,</span> <span class="nb">dirname</span><span class="p">(</span><span class="k">__FILE__</span><span class="p">)</span> <span class="o">.</span> <span class="nx">DIRECTORY_SEPARATOR</span><span class="p">);</span>
    <span class="k">require</span> <span class="nx">ROOT</span> <span class="o">.</span> <span class="s1">'application/Config/config.php'</span><span class="p">;</span>
    <span class="k">require</span> <span class="nx">ROOT</span> <span class="o">.</span> <span class="s1">'core/Application.php'</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">'url'</span><span class="p">])</span> <span class="k">or</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">'url'</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'index.php'</span><span class="p">)</span> <span class="p">{</span>
        <span class="nb">header</span><span class="p">(</span><span class="s1">'Location: /songs'</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nb">header</span><span class="p">(</span><span class="s1">'Content-Type: application/json'</span><span class="p">);</span>
    <span class="nv">$application</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Application</span><span class="p">();</span>
    <span class="nv">$response</span> <span class="o">=</span> <span class="nv">$application</span><span class="o">-&gt;</span><span class="na">dispatch</span><span class="p">();</span>
    <span class="k">echo</span> <span class="nb">json_encode</span><span class="p">(</span><span class="nv">$response</span><span class="p">,</span> <span class="nx">JSON_PRETTY_PRINT</span> <span class="o">|</span> <span class="nx">JSON_UNESCAPED_SLASHES</span><span class="p">);</span>
<span class="cp">?&gt;</span>
</code></pre></div></div> <p>Baza de date:</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">IF</span> <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="nv">`tw_rest`</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`tw_rest`</span><span class="p">.</span><span class="nv">`song`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="n">int</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="nv">`artist`</span> <span class="n">text</span> <span class="k">COLLATE</span> <span class="n">utf8_unicode_ci</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`track`</span> <span class="n">text</span> <span class="k">COLLATE</span> <span class="n">utf8_unicode_ci</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`link`</span> <span class="n">text</span> <span class="k">COLLATE</span> <span class="n">utf8_unicode_ci</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="nv">`id`</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="n">AUTO_INCREMENT</span><span class="o">=</span><span class="mi">1</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_unicode_ci</span><span class="p">;</span>
</code></pre></div></div> </div> </section> </div> </div> <div class="toc-sidebar hidden-xs"> <nav id="toc-nav"> <ul id="toc-menu" class="toc-menu nav nav-stacked" data-spy="affix" data-offset-top="180"> <li><a class="scrollto" href="#consultarea-resurselor">Consultarea resurselor</a> </li> <li><a class="scrollto" href="#recapitulare">Recapitulare</a> <ul class="toc-sub-menu nav nav-stacked"> <li><a class="scrollto" href="#exercițiu-de-laborator">Exercițiu de laborator</a> </li> <li><a class="scrollto" href="#soluție-incompletă">Soluție incompletă</a> </li></ul></li> <li><a class="scrollto" href="#test-de-laborator---1">Test de laborator - 1</a> <ul class="toc-sub-menu nav nav-stacked"> <li><a class="scrollto" href="#enunț">Enunț</a> </li> <li><a class="scrollto" href="#soluție-posibilă">Soluție posibilă</a> </li></ul></li> <li><a class="scrollto" href="#invocarea-serviciilor-web">Invocarea serviciilor web</a> <ul class="toc-sub-menu nav nav-stacked"> <li><a class="scrollto" href="#exercițiu-de-laborator-1">Exercițiu de laborator</a> </li> <li><a class="scrollto" href="#punct-de-plecare">Punct de plecare</a> </li> <li><a class="scrollto" href="#alternativă-simplificată">Alternativă simplificată</a> </li></ul></li> <li><a class="scrollto" href="#test-de-laborator---2">Test de laborator - 2</a> </li> <li><a class="scrollto" href="#implementarea-serviciilor-web">Implementarea serviciilor web</a> <ul class="toc-sub-menu nav nav-stacked"> <li><a class="scrollto" href="#exercițiu-de-laborator-2">Exercițiu de laborator</a> </li></ul></li> </ul> </nav> </div> </div> </div> </section> </div> <footer class="footer text-center"> <div class="container-fluid"> <div class="row"> <div class="col-md-2 col-xs-6"> <small class="copyright"> Bazat pe <a href="https://github.com/xriley/PrettyDocs-Theme" target="_blank">PrettyDocs</a>, dezvoltat de <a href="http://themes.3rdwavemedia.com/" target="_blank">Xiaoying Riley</a>. </small> </div> <div class="offset-md-2 col-md-8 col-xs-6"> <small> Ultima actualizare: 23 mai 2019 / <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="Conținut licențiat sub termenii Attribution-NonCommercial-ShareAlike 4.0 International">CC</a> <br/><a href="https://profs.info.uaic.ro/~alex.coman/" title="Spre situl Web al titularului laboratorului Alexandru Coman.">Alexandru Coman</a> </small> </div> </div> </div> </footer> <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script> <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-scrollTo/2.1.2/jquery.scrollTo.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.matchHeight/0.7.2/jquery.matchHeight-min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.min.js"></script> <script src="/~alex.coman/assets/js/main.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script> <script>hljs.initHighlightingOnLoad();</script> </body> </html>
