<!DOCTYPE html> <!--[if IE 8]> <html lang="ro" class="ie8"> <![endif]--> <!--[if IE 9]> <html lang="ro" class="ie9"> <![endif]--> <!--[if !IE]><!--> <html lang="ro"> <!--<![endif]--> <head> <title>Vagrant - noțiuni introductive</title> <!-- Meta --> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" lang="ro" xml:lang="ro" content="Situl dedicat laboratoarelor susținute în cadrul Facultății de Informatică din Iași." /> <meta name="keywords" lang="en" xml:lang="en" content="Web, WWW, technology, course, Romania, Iasi, Computer Science, university, academic, information, education, school, project, lang programming, document, software, application, student, grade" /> <meta name="keywords" lang="ro" xml:lang="ro" content="Web, WWW, technologie, curs, Romania, Iasi, Informatica, universitate, academic, informatie, educatie, scoala, proiect, limbaj, programare, document, software, aplicatie, student, nota" /> <link rel="shortcut icon" href="/assets/images/favicon.ico"> <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'> <!-- Global CSS --> <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"> <!-- Plugins CSS --> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.css"> <!-- Theme CSS --> <link id="theme-style" rel="stylesheet" href="/assets/css/main.css"> <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries --> <!--[if lt IE 9]> <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script> <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script> <![endif]--> <link rel="canonical" href="https://teaching.alexcoman.com/resurse/tutorial/vagrant/notiuni-introductive/"> <link rel="alternate" type="application/rss+xml" title="" href="/feed.xml"> <script defer src="https://use.fontawesome.com/releases/v5.0.6/js/all.js"></script> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" integrity="sha256-3YM6A3pH4QFCl9WbSU8oXF5N6W/2ylvW0o2g+Z6TmLQ=" crossorigin="anonymous" /> </head> <body > <div class="page-wrapper"> <header id="header" class="header "> <div class="container"> <div class="branding"> <h1 class="logo"> <a href="/resurse/tutorial/vagrant/notiuni-introductive/"> <span aria-hidden="true" class="icon fas fa-laptop"></span> <span class="text-highlight">Laboratoare</span> <span class="text">@FII</span> </a> </h1> </div> <ol class="breadcrumb"> <li><a href="/">Acasă</a></li> <li><a href="/resurse">Resurse</a></li> <li><a href="/resurse/tutorial">Tutorial</a></li> <li><a href="/resurse/tutorial/vagrant">Vagrant</a></li> <li class="active">Vagrant - noțiuni introductive</li> </ol> </div> </header> <section id="blog_post" class="blog-post-section doc-wrapper"> <div class="container"> <div id="doc-header" class="doc-header text-center"> <h1 class="doc-title" itemprop="name headline"> <i class="icon fas fa-paper-plane"></i> Vagrant - noțiuni introductive </h1> <div class="meta"> Publicat de: <span itemprop="author" itemscope itemtype="http://schema.org/Person"> <span itemprop="name">Sabin Marcu</span> </span> pe <i class="fas fa-clock"></i> <time datetime="2017-03-19T12:00:00+00:00" itemprop="datePublished"> 19 martie 2017 </time> </div> </div> <div class="doc-body"> <div class="doc-content"> <div class="content-inner"> <section id="dashboards" class="doc-section"> <div class="section-block"> <p>În ultimii ani, virtualizarea și standardizarea mașinilor virtuale a devenit un subiect din ce în ce mai dezbătut, și populat de diferite sisteme ce își doresc a face acest subiect o realitate cât mai accesibilă. Unul dintre aceste sisteme, realizat modular, este <strong>Vagrant</strong>. În următoarele rânduri vom vorbi despre ce este mai exact Vagrant, cum funcționează și cum se instaleaza și configurează acest sistem.</p> <!--more--> <h3 id="ce-este-vagrant">Ce este Vagrant?</h3> <p>Dacă veți căuta pe Google <strong>Vagrant</strong>, veți obține aproximativ următoarea definiție:</p> <p class="center"><img src="/assets/img/vagrant/def.png" alt="Imagine definiție vagrant" /></p> <p>Vagrant este definit ca <code class="highlighter-rouge">o persoană fără un cămin stabilit sau job stabil ce se mută din loc în loc</code>. Într-un fel, această descriere se potrivește destul de bine software-ului <em>Vagrant</em>.</p> <p>Software-ul Vagrant este un sistem de configurare, distribuție și virtualizare a mediilor de lucru, dezvoltare și publicare. El permite, prin o mulțime de aplicații externe, configurarea, aprovizionarea și distribuirea ușoară a mașinilor virtuale, cu scopul de a standardiza și ușura pregătirea unui mediu pentru dezvoltarea sau publicarea unei aplicații, sau a obține accesul la unelte necesare lucrului disponibile doar pe anumite sisteme de operare.</p> <p>Un exemplu concret ar fi izolarea mediilor de dezvoltare, și automatizare compilări și creării aplicațiilor pe medii diferite (Windows pentru aplicații Windows Phone, Mac OS X pentru aplicații iOS etc). Un alt exemplu ar fi experimentarea fără a polua mașina locală, sau izolarea experimentelor între ele.</p> <p>Acest proces este descris într-un singur fișier ce poate fi copiat din loc în loc, creând mediul dorit pe orice mașină gazdă (fie fizică, fie virtuală). Mediul creat poate fi atunci modificat în orice mod, iar când este creat din nou, va reveni la starea inițială definită în fișier.</p> <p>Vagrant nu este o persoană, dar poate călători din loc în loc, fără un cămin anume sau job stabil. Este o soluție pentru omogenizarea mediului de lucru între membrii unei echipe de development, a publicării în paralel a unui software, sau oricărei alte acțiuni ce necesită un punct de plecare predefinit. Vagrant oferă acest punct de plecare într-un mod minimalist și sigură.</p> <h3 id="cum-funcționează-vagrant">Cum funcționează Vagrant?</h3> <p>Vagrant este un sistem de gestionare și configurare a mașinilor virtuale create de către diferite sisteme de virtualizare (VirtualBox, VMWare, Docker, etc).</p> <p>Vagrant utilizează o mulțime de <strong>mașini virtuale pre-definite</strong> pentru diferite sisteme de operare (Windows, Ubuntu, Mac OS X, Red Hat etc.) și diferite versiuni ale acestor sisteme. Vagrant va descărca aceste mașini virtuale pre-definite dorite, și va crea copii ale lor când este nevoie. Aceste mașini de obicei sunt create minimalist, cu un numar minim de utilitare și configurații realizate, pentru a se potrivi unei game cât mai largi de cerințe.</p> <p>Din acest moment, mașina virtuală copiată va fi <strong>aprovizionată</strong>. Aprovizionarea (sau <em>Provisioning-ul</em>) mașinii se realizează prin mai multe moduri, descrise mai jos, scopul fiind pregătirea mașinii pentru lucru, fie prin instalarea soft-urilor necesare, pornirea unor servicii, fie prin legarea elementelor din mașina virtuală cu cele din mașina gazdă (cea care reulează mașina virtuală) precum rețea sau fișiere și foldere.</p> <p>După ce crearea mașinii virtuale este terminată, ea poate fi pornită. În acest moment se rulează aprovizionarea. Când aprovizionarea este terminată, mașina poate fi accesată fie prin SSH, fie prin alte metode (pentru VirtualBox, VMWare, etc. mașina poate fi accesată din iterfață serviciului).</p> <p>Informațiile necesare creeri și aprovizionării unei astfel de mașini sunt stocate într-un fișier numit <em>Vagrantfile</em>. Acest fișier poate fi pur și simplu transferat pe o altă mașină (fizică sau virtuală) de unde tot procesul poate fi reluat fără nici o modificare, fără a necesita decât prezența utilitarului Vagrant și a provider-ului (VirtualBox, VMWare, etc).</p> <h2 id="instalare">Instalare</h2> <p>Înainte de a începe instalarea <strong>Vagrant</strong> trebuie să ne asigurăm că Vagrant va avea un sistem de mașini virtuale pe care îl va putea folosi. Vagrant suportă un numar de astfel de sisteme printre care și: <em>VirtualBox</em>, <em>VMWare</em>, <em>Docker</em>, <em>Hyper-V</em>, etc. Conexiunea pentru aceste sisteme se realizează prin plugin-uri numite <em>Provideri</em>. Vagrant vine pre-instalat cu suport pentru <em>VirtualBox</em>, iar suportul pentru alte platforme (platforme care de obicei necesită licență plătită) este de obicei oferit contra-cost.</p> <p>Prin urmare, vom folosi <strong>VirtualBox</strong> pentru a lucra cu Vagrant, iar înainte de a instala / folosi Vagrant, trebuie să ne asigurăm că <em>VirtualBox</em> este instalat. Pentru a instala VirtualBox, va trebui să accesați <a href="https://www.virtualbox.org/wiki/Downloads">pagina de descărcare</a> și să descărcați și instalați versiunea potrivită sistemului de operare folosit.</p> <h3 id="linux-ubuntu">Linux (Ubuntu)</h3> <p>Pentru scopul acestui tutorial se va folosi o instalare de <strong>Ubuntu</strong> deoarece este cea mai populară / folosită distribuție de <em>linux</em> la momentul actual. Procedeul de instalare pentru alte distribuții este similar.</p> <p>Primul pas spre a instala Vagrant pe o mașină Ubuntu / Linux este a descărca pachetul de instalare <em>.deb</em> (ultima versiune disponibilă la data creări articolului este <strong>vagrant_1.7.3</strong>). Pachetul va trebui ales și în funcție de arhitectura sistemului de operare, fie <em>32 de biți</em>, fie <em>64 de biți</em>. Dacă nu sunteți siguri, folosiți varianta pe <em>32 de biți</em>. Aceasta imagine este disponibilă la <a href="http://www.vagrantup.com/downloads.html">adresa de descărcare a site-ului</a> Vagrant, ilustrată in imaginea de mai jos:</p> <p class="center"><img src="/assets/img/vagrant/ubuntu/website.png" alt="Imagine pagină de descărcare" /></p> <p>După ce pachetul este descărcat, rulați fișierul fie din meniul / fereastra de download a browser-ului, fie din <em>File Explorer</em> (Nautilus în cazul Ubuntu). La deschiderea fișierului o fereastră asemănătoare cu cea de mai jos se va deschide, pentru a iniția procesul de instalare. Utilizatorul va trebui să urmărească un fir standard de execuție, prin a apăsa butonul de instalare. La un moment dat, utilizatorul va fi solicitat să introducă parola sa pentru a putea efectua instalarea. Procesul este ilustrat în imaginile de mai jos:</p> <p class="center"><img src="/assets/img/vagrant/ubuntu/installwindow.png" alt="Imagine fereastră de instalare" /></p> <p class="center"><img src="/assets/img/vagrant/ubuntu/pass.png" alt="Imagine fereastră de autentificare" /></p> <p>La sfârșitul instalării, fereastra inițială va afișa faptul că pachetul este instalat, într-o manieră similară ca cea prezentată mai jos:</p> <p class="center"><img src="/assets/img/vagrant/ubuntu/finishedinstall.png" alt="Imagine fereastră de instalare finalizata" /></p> <p>într-un final, utilizatorul poate verifica dacă Vagrant a fost instalat pentru a deschide un emulator de terminal (Ubuntu: aplicația Terminal. Nota: Aplicația terminal poate fi pornit într-un instalare tipică de Ubuntu prin combinația de taste <strong><code class="highlighter-rouge">Control</code> + <code class="highlighter-rouge">Alt</code> + <code class="highlighter-rouge">T</code></strong>) și introducerea comenzii :</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vagrant <span class="nt">--help</span>
</code></pre></div></div> <p>sau</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vagrant <span class="nt">--version</span>
</code></pre></div></div> <p>Exemplu:</p> <p class="center"><img src="/assets/img/vagrant/ubuntu/vagranthelp.png" alt="Imagine ajutor vagrant" /></p> <h3 id="mac-os-x">Mac OS X</h3> <p>Primul pas spre a instala Vagrant pe o mașină OS X este a descărca imaginea de instalare <em>.dmg</em> (ultima versiune disponibilă la data creări articolului este <strong>vagrant_v1.7.3.dmg</strong>). Aceasta imagine este disponibilă la <a href="http://www.vagrantup.com/downloads.html">adresa de descărcare a site-ului</a> Vagrant, ilustrată in imaginea de mai jos:</p> <p class="center"><img src="/assets/img/vagrant/macos/download.png" alt="Imagine pagină de descărcare" /></p> <p>După ce imaginea este descărcată, dacă nu se montează automat, faceți <code class="highlighter-rouge">dublu-click</code> pe fișier pentru a îl monta. După ce imaginea este montată, se va deschide o fereastră <em>Finder</em> cu conținutul, ce va arătă asemănător cu imaginea de mai jos:</p> <p class="center"><img src="/assets/img/vagrant/macos/image.png" alt="Imagine conținut imagine" /></p> <p>În acest moment, va trebui executat fișierul <code class="highlighter-rouge">Vagrant.pkg</code> pentru a iniția instalarea. Instalarea urmează un fir standard de execuție, necesitând apăsarea butonului de continuare de două ori, oferind opțiunea de a schimba locația instalării. La sfârșitul acestui proces, utilizatorul va fi solicitat să introducă parola sa pentru a putea efectua instalarea. Procesul este ilustrat în imaginile de mai jos:</p> <p class="center"><img src="/assets/img/vagrant/macos/firststep.png" alt="Imagine prim pas al instalării" /></p> <p class="center"><img src="/assets/img/vagrant/macos/installlocation.png" alt="Imagine alegere a locației instalării" /></p> <p class="center"><img src="/assets/img/vagrant/macos/pass.png" alt="Imagine solicitare a parolei'" /></p> <p>Instalarea va continua până la sfârșit, prezentând următoarea fereastră:</p> <p class="center"><img src="/assets/img/vagrant/macos/installcomplete.png" alt="Imagine terminare instalare" /></p> <p>În acest moment este recomandată demontarea imaginii, din moment ce instalarea este finalizată. Demontarea se realizează prin apăsarea butonului indicat în imaginea de mai jos.</p> <p class="center"><img src="/assets/img/vagrant/macos/unmount.png" alt="Imagine demontare imagine" /></p> <p>Din acest moment, utilizarea programului command line <code class="highlighter-rouge">vagrant</code> va fi posibil folosind aplicația <code class="highlighter-rouge">Terminal.app</code> (sau <code class="highlighter-rouge">iTerm2.app</code> sau orice alt emulator terminal preferat). Exemplu de funcționalitate este prezentat mai jos:</p> <p class="center"><img src="/assets/img/vagrant/macos/vagranthelp.png" alt="Imagine execuție vagrant help" /></p> <h3 id="windows">Windows</h3> <p>Pentru început, instalați VirtualBox, versiunea pentru Windows! Se poate descărca de <a href="https://www.virtualbox.org/wiki/Downloads">aici</a></p> <p>După aceasta, instalați Vagrant, versiunea de Windows, ce se găsește <a href="http://www.vagrantup.com/downloads.html">aici</a>. Instalarea este simplă, urmând tiparul obisnuit de <em>Next</em>, <em>Next</em>, … <em>Finish</em>. După instalare, windows-ul va cere un restart pentru a ajuta Vagrant-ul să-și creeze configurările, iar după restart, puteți verifica în cmd dacă s-a instalat, folosind comanda <code class="highlighter-rouge">vagrant</code>. Dacă totul a decurs bine, va trebui să se afișeze ceva asemănător cu ce este în imaginea următoare:</p> <p class="center"><img src="/assets/img/vagrant/windows/vagrant_cmd.png" alt="Imagine vagrant cmd" /></p> <p>În cele din urmă, a mai rămas un singur pas, și anume faptul că Vagrant are nevoie de un client SSH, iar Windows 7/8 nu îl contine by default, așa că vom folosi Putty. Pentru a-l avea, trebuie doar să-l descărcați de <a href="http://www.chiark.greenend.org.uk/~sgtatham/putty/download.html">aici</a> și alegeți ultima versiune pentru Windows (click pe <em>putty.exe</em>). Dacă deschideți ceea ce ați descărcat, ar trebui să vă apară o fereastră ce arată cam așa:</p> <p class="center"><img src="/assets/img/vagrant/windows/putty.png" alt="Imagine putty" /></p> <h2 id="quickstart-101">Quickstart (101)</h2> <p><strong>Initializare</strong></p> <p>Deși atunci când ați rulat <code class="highlighter-rouge">vagrant</code> în cmd a apărut o listă de comenzi, pentru a seta un server propriu cu ajutorul Vagrant este nevoie doar de câteva dintre ele. Comanda <code class="highlighter-rouge">vagrant init</code> va crea în director un fișier Vagrantfile, ce conține detalii legate de configurare. Este un exercițiu bun să îl deschideți și să parcurgeți conținutul.</p> <p class="center"><img src="/assets/img/vagrant/windows/vagrant_init.png" alt="Imagine vagrant init" /></p> <p><strong>Cum să vă creați propriul server?</strong></p> <p>Pentru început, creați un folder în care va fi proiectul și serverul, apoi deschideți un Command Prompt în acest director, unde rulați comanda:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vagrant init ubuntu/trusty64
</code></pre></div></div> <p>Aceasta va crea fișierul Vagrantfile, descris mai sus. Vagrant pune la dispoziția noastră anumite box-uri (detalii în capitolul următor), iar pentru acest exemplu vom folosi <code class="highlighter-rouge">ubuntu/trusty64</code> care va configura un server cu Ubuntu. Următoarea comandă ce trebuie rulată este:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vagrant up
</code></pre></div></div> <p>La prima rulare a acestei comenzi se crează o mașină virtuală conform configurărilor din fișierul Vagrantfile creat la inițializare. Pentru a verifica la final că mașina rulează într-adevăr, deschideți VirtualBox și ar trebui să apară ceva asemănător ca în imagine:</p> <p class="center"><img src="/assets/img/vagrant/windows/vagrant_vb.png" alt="Imagine vagrant VirtualBox" /></p> <p>De asemenea, de fiecare dată când doriți doar să deschideți mașina, se execută comanda <code class="highlighter-rouge">vagrant up</code>.</p> <p>Ultima comandă ce trebuie executată este:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vagrant ssh
</code></pre></div></div> <p>Aceasta va deschide un shell în Unbuntu, adică în mașina ce tocmai am instalat-o.</p> <p><strong>Comenzi utile</strong></p> <ul> <li><code class="highlighter-rouge">vagrant up</code> pentru a porni mașina</li> <li><code class="highlighter-rouge">vagrant halt</code> pentru a opri mașina</li> <li><code class="highlighter-rouge">vagrant ssh</code> pentru a deschide shell-ul mașinii create</li> <li><code class="highlighter-rouge">vagrant reload</code> pentru a reporni mașina</li> <li><code class="highlighter-rouge">vagrant destroy</code> pentru a șterge mașina și toate configurările acesteia</li> <li><code class="highlighter-rouge">vagrant status</code> pentru a verifica statusul mașinii Vagrant (dacă este pornită, oprită, creată, etc)</li> <li><code class="highlighter-rouge">vagrant version</code> pentru a afișa versiunea de Vagrant instalată</li> <li><code class="highlighter-rouge">vagrant provision</code> pentru a forța rularea tuturor script-urilor (definițiilor) de aprovizionare</li> </ul> <p>Sfat și mic exercițiu: deschideți un Command Prompt și rulați ` vagrant ` pentru a vedea lista tuturor comenzilor disponibile Și o scurtă descriere pentru fiecare, apoi rulați fiecare comandă afișată cu opțiunea ` -h ` (de exemplu, pentru ` init <code class="highlighter-rouge">, rulați </code> vagrant init -h ` și așa mai departe cu toate).</p> <h3 id="box-uri-posibile"><em>Box</em>-uri posibile</h3> <p>După cum ați văzut mai sus, pentru a inițializa o mașină, s-a rulat comanda <code class="highlighter-rouge">vagrant init ubuntu/trusty64</code>, iar aceasta înseamnă că s-a clonat o mașină virtuală pe care s-a instalt Ubuntu. Vagrant folosește multe astfel de imagini, din care puteam alege ce avea nevoie. Acestea poartă denumirea de <em>boxes</em>.</p> <p><strong>Cum adăugăm un <em>box</em>?</strong></p> <p>La adresa <a href="https://atlas.hashicorp.com/boxes/search">HarshiCorp</a> putem găsi lista întreagă a <em>box</em>-urilor disponibile. Pentru a crea o mașină căreia să-i adăugăm apoi un <em>box</em>, spre exemplu hashicorp/precise32, folosim următoarele:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>vagrant init
<span class="nv">$ </span>vagrant box add hashicorp/precise32
</code></pre></div></div> <p>Iar pentru a modifica configurarea și a putea folosi mașina, mai avem un singur pas. Deschideți fișierul Vagrantfile și modifcați următoarele rânduri:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"hashicorp/precise32"</span>
<span class="k">end</span>
</code></pre></div></div> <p><strong>Comenzi utile</strong></p> <ul> <li><code class="highlighter-rouge">vagrant box add &lt;numele _box_-ului&gt;</code> pentru a adăuga un <em>box</em></li> <li><code class="highlighter-rouge">vagrant box list</code> pentru a afișa lista <em>box</em>-urilor instalate local</li> <li><code class="highlighter-rouge">vagrant box update &lt;numele _box_-ului&gt;</code> pentru a actualiza</li> <li><code class="highlighter-rouge">vagrant box remove &lt;numele _box_-ului&gt;</code> pentru a șterge <em>box</em>-ul dorit</li> </ul> <p>Tot ce mai este de făcut mai departe este să porniți mașina cu <code class="highlighter-rouge">vagrant up</code> și s-o folosiți!</p> <h2 id="configurare-avansată">Configurare Avansată</h2> <p>După cum am menționat mai devreme, <code class="highlighter-rouge">vagrant init</code> va genera un fișier de configurație numit <strong>Vagrantfile</strong>. Acest fișier este realizat în limbajul <strong>ruby</strong>, și va trebui să respecte <em>regulile de sintaxă</em> ale acestui limbaj. Opțiunile de configurare urmează următorul tipar <code class="highlighter-rouge">config.vm.&lt;modul&gt; &lt;opțiuni&gt;</code> unde <em>modul</em> reprezintă modulul resonsabil cu resepectiva configurare (Exemplu: “provision”, “network”) iar <em>opțiuni</em> un set de argumente alocate metodei de configurare. Există excepții de la regulă, respectând tiparul <code class="highlighter-rouge">config.vm.&lt;variabilă&gt; = &lt;valoare&gt;</code> cu anumite opțiuni simple ce necesită doar atribuirea unei valori.</p> <p>Exemplu:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

    <span class="c1"># Setarea tipului de *box* folosit</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"ubuntu/trusty32"</span>

    <span class="c1"># Setarea unui canal de provisioning sub forma unui fișier de configurare (explicat mai târziu)</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="ss">:shell</span><span class="p">,</span> <span class="ss">path: </span><span class="s2">"configure"</span>

    <span class="c1"># Setarea unui canal de provisioning sub forma unei secvențe de instrucțiuni (explicat mai târziu)</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="ss">:shell</span><span class="p">,</span> <span class="ss">inline: </span><span class="o">&lt;&lt;-</span><span class="no">SHELL</span><span class="sh">
        sudo apt-get update
</span><span class="no">    SHELL</span>

    <span class="c1"># Setarea unui alt punct de montare pentru un fișier aparținând sistemului de operare gazdă</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">synced_folder</span> <span class="s2">"../"</span><span class="p">,</span> <span class="s2">"/tutorial"</span>

    <span class="c1"># Setarea unei configurații de tipul *port forward* (explicat mai târziu)</span>
    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"forwarded_port"</span><span class="p">,</span> <span class="ss">guest: </span><span class="mi">8000</span><span class="p">,</span> <span class="ss">host: </span><span class="mi">9000</span>
<span class="k">end</span>
</code></pre></div></div> <p>Script-urile sunt rulate de către utilizatorul <strong>root</strong> al mașinii virtuale dacă nu este specificat parametrul <code class="highlighter-rouge">privileged: false</code> al configurației. În acest caz, script-ul este rulat de către utilizatorul <strong>vagrant</strong> al mașinii virtuale. Mașinile virtuale cu sistem de operare Windows nu sunt afectate de acest parametru.</p> <p>În același timp, script-urile de aprovizionare sunt rulate o singură dată dacă nu este specificat un alt comportament. Prin parametrul <code class="highlighter-rouge">run: 'always'</code> al configurației, se specifică rularea script-ului la fiecare lansare a mașinii virtuale.</p> <p>Exemplul de mai jos folosește o metodă de descriere alternativă a configurației, specificând rularea la fiecare lansare și rulează script-ul fără privilegii de administrator.</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> <span class="ss">run: </span><span class="s2">"always"</span> <span class="k">do</span> <span class="o">|</span><span class="n">setup</span><span class="o">|</span>
    <span class="n">setup</span><span class="p">.</span><span class="nf">path</span> <span class="o">=</span> <span class="s2">"provision/run_always.sh"</span>
    <span class="n">setup</span><span class="p">.</span><span class="nf">privileged</span> <span class="o">=</span> <span class="kp">false</span>
<span class="k">end</span>
</code></pre></div></div> <p>Mai multe detalii legate de aceste opțiuni pot fi găsite la <a href="http://docs.vagrantup.com/v2/provisioning/shell.html">această adresă</a>.</p> <h3 id="provisioning">Provisioning</h3> <p>Provisioning este modul prin care <em>Vagrant</em> pregătește mașina virtuală la fiecare instanțiere. Provisioning-ul se realizează fie printr-un sistem specializat precum <strong>Docker</strong> și <strong>Salt</strong> (<a href="http://docs.vagrantup.com/v2/provisioning/index.html">lista completă</a>) sau script-uri shell. Pentru scopul acestui tutorial, ne vom limita la a folosi script-uri shell. Acestea pot fi declarate în două moduri diferite, fie printr-un <em>fișier</em> (exemplu: <code class="highlighter-rouge">config.vm.provision :shell, path: "configure"</code>), fie printr-un <em>string inline</em> (exemplu: <code class="highlighter-rouge">config.vm.provision :shell, inline: "sudo apt-get update"</code>). Un exemplu avansat de script de provisioning poate fi găsit în repositorul git al acestui tutorial la <a href="https://github.com/sabinmarcu/vagrant-tutorial/tree/master">această adresă</a>, în folder-ul <strong>advanced</strong> (<a href="https://github.com/sabinmarcu/vagrant-tutorial/tree/master/advanced">link direct</a>). Acest script este numit <strong>configure</strong>, și, printre funcții auxiliare și de formatare, veți găsi metode ce verifică dacă un anumit software este prezent pe mașina virtuală, și încearcă să îl obțină și să îl instaleze, folosind metode diferite pe sisteme de operare diferite. Acest script a fost testat pe o mașină <em>Ubuntu</em> și una <em>Mac OS X</em> până la momentul de față. O variantă simplificată a acestui script poate fi găsit în folder-ul în folder-ul <strong>portforward</strong> (<a href="https://github.com/sabinmarcu/vagrant-tutorial/tree/master/portforward">link direct</a>).</p> <p>De obicei, când se intenționează folosirea unui singur tip de sistem de operare cu <em>Vagrant</em>, configurarea este mult mai simplă. Exemplu:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">#!/bin/bash</span>

apt-get update              &amp;&gt; /dev/null <span class="o">||</span> <span class="nb">sudo </span>apt-get update             &amp;&gt; /dev/null
apt-get <span class="nb">install </span>python2.7   &amp;&gt; /dev/null <span class="o">||</span> <span class="nb">sudo </span>apt-get <span class="nb">install </span>python2.7  &amp;&gt; /dev/null
apt-get <span class="nb">install </span>screen      &amp;&gt; /dev/null <span class="o">||</span> <span class="nb">sudo </span>apt-get <span class="nb">install </span>screen     &amp;&gt; /dev/null
</code></pre></div></div> <p>Pentru configurarea provisioning-ului există câteva opțiuni suplimentare ce se pot dovedi utile, printre care:</p> <ul> <li><code class="highlighter-rouge">keep_color: true</code> ce va asigura că Vagrant nu va colora diferit output-ul provisioning-ului (folosirea culorilor în mesajele emise de un provisioning pot fi foarte utile în depanarea script-ului sau mentenanță)</li> <li><code class="highlighter-rouge">run: "always"</code> ce va asigura că Vagrant va rula acest script la fiecare pornire a mașinii virtuale, nu numai la prima rulare sau când este specificat cu argumentul <code class="highlighter-rouge">--provision</code> (<code class="highlighter-rouge">vagrant up --provision</code> / <code class="highlighter-rouge">vagrant provision</code> / <code class="highlighter-rouge">vagrant reload --provision</code>)</li> <li><code class="highlighter-rouge">privileged: false</code> ce va asigura că Vagrant nu va rula acest script sub cont de administrație (root); folosirea argumentului cu valoare adevărată va asigura rularea script-ului cu permisie elevată</li> </ul> <p>Exemplu:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

    <span class="c1"># ...</span>

    <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="ss">:shell</span><span class="p">,</span> <span class="ss">path: </span><span class="s2">"run"</span><span class="p">,</span> <span class="ss">privileged: </span><span class="kp">false</span><span class="p">,</span> <span class="ss">keep_color: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">run: </span><span class="s2">"always"</span>

<span class="k">end</span>
</code></pre></div></div> <h3 id="foldere-sincronizate">Foldere sincronizate</h3> <p>Vagrant are posibilitatea de a sincroniza foldere din mașina gazdă cu cea virtuală. Pentru orice mașină Vagrant există cel puțin o asemenea sincronizare, între folder-ul în care se află fișierul <strong>Vagrantfile</strong> pe <em>mașina gazdă</em> și calea <code class="highlighter-rouge">/vagrant</code> pe mașina virtuală. Asemenea sincronizări adiționale se pot specifica în fișierul <strong>Vagrantfile</strong> ca în exemplul următor:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

  <span class="c1"># ...</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">synced_folder</span> <span class="s2">"~/Desktop"</span><span class="p">,</span> <span class="s2">"/host_desktop"</span>

<span class="k">end</span>
</code></pre></div></div> <p>Exemplul de mai sus va sincroniza folderul <strong>Desktop</strong> al utlizatorului curent (se presupune folosirea unui sistem de operare Unix) cu calea <code class="highlighter-rouge">/host_desktop</code> a mașinii virtuale.</p> <h3 id="port-forwarding">Port Forwarding</h3> <p>După cum am arătat mai sus, în configurarea unei mașini Vagrant, există opțiunea de a face <em>port forwarding</em>. Port forwarding este un mapping între port-uri deschise pe mașina virtuală și pe <em>host</em>, sau mașina de pe care este rulată cea virtuală. Această opțiune este foarte utilă în multe cazuri. Spre exemplu, traficul internet pentru port-ul 80 (http standard) al calculatorului de pe care se lucrează mașina Vagrant poate fi redirecționat direct în mașina virtuală, omițând sistemul de operare de bază, pentru a asigura securitatea și izolarea în mașina virtuală. Un alt exemplu ar fi rulând un server simplu de date pe același port în mai multe mașini virtuale identice, dar cu mapping diferit, pentru a fi preluate in <em>host</em> de catre un server de colecție, pentru a asigura o formă de paralelism.</p> <p>Pentru a utiliza <em>port forwarding</em>, este necesar a adăuga o linie suplimentară într-o configurație <strong>Vagrantfile</strong>, ca în exemplul următor, unde port-ul <strong>8000</strong> al <em>mașinii virtuale</em> este legat de port-ul <strong>9000</strong> al <em>mașinii gazdă</em>:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

  <span class="c1">#  ... other configuration options</span>

  <span class="c1"># Mapping port 8000 on the virtual machine to port 9000 of the host</span>
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"forwarded_port"</span><span class="p">,</span> <span class="ss">guest: </span><span class="mi">8000</span><span class="p">,</span> <span class="ss">host: </span><span class="mi">9000</span>

<span class="k">end</span>
</code></pre></div></div> <p>Un exemplu concret este disponibil în repositorul git al acestui tutorial la <a href="https://github.com/sabinmarcu/vagrant-tutorial/tree/master">această adresă</a>, în folder-ul <strong>portforward</strong> (<a href="https://github.com/sabinmarcu/vagrant-tutorial/tree/master/portforward">link direct</a>). Acest demo conține două script-uri: <code class="highlighter-rouge">configure</code> care se a asigura că <strong>python</strong> și <strong>screen</strong> există pe mașina virtuală și este rulat doar <em>o singură dată</em>, iar <code class="highlighter-rouge">run</code> va rula un server simplu http cu python în directorul curent (al mașinii gazdă) în mașina virtuală într-o instanță screen pentru a menține execuția indiferent de activitatea utilizatorului, cât timp mașina rulează. Utilizatorul poate verifica starea server-ului și conectivitatea prin accesarea <a href="http://localhost:9000">adresei din mapping</a>. Folder-ul va conține un fișier HTML ce va afișa la ce port rulează aplicația pe server-ul din mașina virtuală, și la ce port este accesat de utilizator.</p> <style> .content-section img{ border: 0; } </style> </div> </section> </div> </div> <div class="toc-sidebar hidden-xs"> <nav id="toc-nav"> <ul id="toc-menu" class="toc-menu nav nav-stacked" data-spy="affix" data-offset-top="180"> <li><a class="scrollto" href="#ce-este-vagrant">Ce este Vagrant?</a> </li> <li><a class="scrollto" href="#cum-funcționează-vagrant">Cum funcționează Vagrant?</a> </li></ul></li> <li><a class="scrollto" href="#instalare">Instalare</a> <ul class="toc-sub-menu nav nav-stacked"> <li><a class="scrollto" href="#linux-ubuntu">Linux (Ubuntu)</a> </li> <li><a class="scrollto" href="#mac-os-x">Mac OS X</a> </li> <li><a class="scrollto" href="#windows">Windows</a> </li></ul></li> <li><a class="scrollto" href="#quickstart-101">Quickstart (101)</a> <ul class="toc-sub-menu nav nav-stacked"> <li><a class="scrollto" href="#box-uri-posibile">-uri posibile</a> </li></ul></li> <li><a class="scrollto" href="#configurare-avansată">Configurare Avansată</a> <ul class="toc-sub-menu nav nav-stacked"> <li><a class="scrollto" href="#provisioning">Provisioning</a> </li> <li><a class="scrollto" href="#foldere-sincronizate">Foldere sincronizate</a> </li> <li><a class="scrollto" href="#port-forwarding">Port Forwarding</a> </li></ul></li> </ul> </nav> </div> </div> </div> </section> </div> <footer class="footer text-center"> <div class="container-fluid"> <div class="row"> <div class="col-md-2 col-xs-6"> <small class="copyright"> Bazat pe <a href="https://github.com/xriley/PrettyDocs-Theme" target="_blank">PrettyDocs</a>, dezvoltat de <a href="http://themes.3rdwavemedia.com/" target="_blank">Xiaoying Riley</a>. </small> </div> <div class="offset-md-2 col-md-8 col-xs-6"> <small> Ultima actualizare: 9 mai 2019 / <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="Conținut licențiat sub termenii Attribution-NonCommercial-ShareAlike 4.0 International">CC</a> <br/><a href="https://teaching.alexcoman.com" title="Spre situl Web al titularului laboratorului Alexandru Coman.">Alexandru Coman</a> </small> </div> </div> </div> </footer> <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script> <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-scrollTo/2.1.2/jquery.scrollTo.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.matchHeight/0.7.2/jquery.matchHeight-min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/ekko-lightbox/5.3.0/ekko-lightbox.min.js"></script> <script src="/assets/js/main.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js" integrity="sha256-/BfiIkHlHoVihZdc6TFuj7MmJ0TWcWsMXkeDFwhi0zw=" crossorigin="anonymous"></script> <script>hljs.initHighlightingOnLoad();</script> </body> </html>
